{% schema %}
{
	"name": "Featured Product (Hero)",
	"settings": [
        {
			"type": "product",
			"id": "product",
			"label": "Product"
		}
	],
    "presets": [{
		"name": "Featured Product (Hero)",
		"category": "Marketing"
	}]
}
{% endschema %}

{% assign product = section.settings.product %}
{% assign product_title_parts = product.title | split: "-" %}
{% assign product_title = product_title_parts[0] | trim %}
{% assign product_subtitle = product_title_parts[1] | trim %}
{% assign product_description = product.metafields.custom.short_description |  metafield_tag %}
{% assign product_size = product.metafields.custom.size %}
{% assign product_benefits = product.metafields.custom.benefits.value %}

{% capture product_header %}
    <div class="flex flex-col gap-half">
        <div class="flex justify-between gap-1 items-baseline">
             <p>
                <a
                    aria-label="{{ product.title }}"
                    href="{{ product.url }}"
                    class="link-opacity-hover uppercase text-30/38 md:text-36/45">
                    {{ product_title }}
                </a>
            </p>

            <p class="text-18/24 md:text-24/30">
                {{ product.price | money_without_trailing_zeros }}
            </p>
        </div>

        <div class="flex justify-between gap-1 items-baseline">
            <div>
                {% if product_subtitle != blank %}
                    <p class="font-serif text-18/24 md:text-24/30">
                        {{ product_subtitle }}
                    </p>
                {% endif %}
            </div>

            <p class="text-16/20">
                {{ product_size }}
            </p>
        </div>

        <div style="display: none;">
            <div
                class="yotpo-widget-instance"
                data-yotpo-instance-id="961416"
                data-yotpo-product-id="{{ product.id }}"
                data-yotpo-cart-product-id="{{ item.product.id }}"
                data-yotpo-section-id="{{ template.name }}">
            </div>
        </div>
    </div>
{% endcapture %}

{% capture product_description %}
    <div class="border-y border-solid border-green py-2 flex flex-col gap-2">
        <div class="rich-text line-break font-serif">
            {{ product_description }}
        </div>

        <div class="flex gap-2 lg:gap-3 justify-center">
            {% for benefit in product_benefits %}
                <div class="flex flex-col items-center gap-1 max-w-8 md:max-w-9">
                    <div
                        data-component="image"
                        class="image aspect-square w-5">
                        <picture class="blur-xl scale-110">
                            {% assign lqip = benefit.image | format: 'jpg' | image_url: width: 10 %}
                            <img
                                src="{{ lqip }}"
                                data-src="{{ benefit.image | image_url: width: 100, height: 100 }}"
                                alt="{{ benefit.image.alt }}"
                            />
                        </picture>
                    </div>

                    <p class="text-12/16 md:text-14/18 text-center">
                        {{ benefit.title }}
                    </p>
                </div>
            {% endfor %}
        </div>
    </div>
{% endcapture %}

{% capture product_form %}
    {% assign is_subscription = false %}

    {% if product.selected_or_first_available_selling_plan_allocation %}
        {% assign is_subscription = true %}
    {% endif %}

    {% form 'product', product, data-component: "productFormSubscription" %}
        <div class="flex flex-col gap-1">
            {% if is_subscription %}
                <input
                    type="hidden"
                    name="id"
                    value="{{ product.selected_or_first_available_variant.id }}"
                />
                
                <input
                    type="hidden"
                    name="selling_plan_id"
                    value="{{ product.selling_plan_groups[0].selling_plans[0].id }}"
                    type="hidden"
                />
    
                <div class="flex flex-col gap-1">
                    <label class="text-12/12 uppercase tracking-wide">Frequency:</label>
    
                    <label class="input-subscription-option">
                        <input 
                            type="radio"
                            name="purchase_type"
                            value="one-time"
                            class="input-subscription-option__input"
                        />
    
                        <div class="input-subscription-option__indicator-container py-1 px-2 border border-solid rounded-20">
                            <div class="flex items-center justify-between">
                                <div class="flex items-center gap-1">
                                    <div class="input-subscription-option__indicator"></div>
                                    <span class="text-18/18 font-serif input-subscription-option__label">One-time Purchase</span>
                                </div>
    
                                <span class="text-14/14 input-subscription-option__label">{{ product.price | money_without_trailing_zeros }}</span>
                            </div>
                        </div>
                    </label>
                    
                    <label class="input-subscription-option">
                        <input 
                            type="radio"
                            name="purchase_type"
                            value="subscription"
                            class="input-subscription-option__input"
                            checked
                        />
    
                        <div class="input-subscription-option__indicator-container py-1 px-2 border border-solid rounded-20">
                            <div class="flex flex-col gap-1">
                                <div class="flex items-center justify-between">
                                    <div class="flex items-center gap-1">
                                        <div class="input-subscription-option__indicator"></div>
                                        <span class="text-18/18 font-serif input-subscription-option__label">Subscribe & Save</span>
                                    </div>
    
                                    <span class="text-14/14 input-subscription-option__label flex gap-half">
                                        <span class="line-through opacity-50">
                                            {{ product.price | money_without_trailing_zeros }}
                                        </span>
                                        <span>
                                            {{ product.selected_or_first_available_selling_plan_allocation.price | money_without_trailing_zeros }}
                                        </span>
                                    </span>
                                </div>
    
                                <div class="relative z-2 pl-[28px] input-subscription-option__details">
                                    <div class="relative">
                                        <select
                                            name="selling-plan-select"
                                            class="input-select block w-full">
                                            {% for allocation in product.variants[0].selling_plan_allocations %}
                                                <option value="{{ allocation.selling_plan.id }}">
                                                    {{ allocation.selling_plan.name }}
                                                </option>
                                            {% endfor %}
                                        </select>

                                        <img
                                            src="{{ 'icon-arrow-drawer.svg' | asset_url }}"
                                            alt="Arrow"
                                            class="block w-[12px] absolute top-1 right-[12px]"
                                        />
                                    </div>
                                </div>
                            </div>
                        </div>
                    </label>
                </div>
            {% endif %}
    
            <div class="w-full relative z-1">
                <button
                    {% unless product.available %}disabled="true"{% endunless %}
                    type="submit"
                    class="block w-full button button-primary-brown">
                    {% if product.available %}
                        {% if is_subscription %}
                            Add to Cart
                        {% else %}
                            Add to Cart
                        {% endif %}
                    {% else %}
                        Sold Out
                    {% endif %}
                </button>
            </div>
        </div>
    {% endform %}
{% endcapture %}

<div class="px-container-mobile md:px-container-desktop my-6 md:my-10">
    <div class="mx-auto max-w-grid">
        <div class="grid grid-cols-6 md:grid-cols-12 gap-y-4 gap-x-gutter-mobile md:gap-gutter-desktop">
            <div class="col-span-6 xl:col-span-5 xl:col-start-2">
                {% render 'product-hero-image-carousel', images: product.images %}
            </div>
            <div class="col-span-6 xl:col-span-5">
                <div class="xl:px-5 md:py-3 flex flex-col gap-2">
                    {{ product_header }}
                    {{ product_description }}
                    {{ product_form }}
                </div>
            </div>
        </div>
    </div>
</div>